<form [formGroup]="echartsLineChartSettingsForm" *ngIf="echartsLineChartSettingsForm" style="width: 100%;">
  <div class="mat-content mat-padding" fxLayout="column" style="width: 100%;">
    
    <!-- Design Settings -->
    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>Design</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        
        <h4>Y-Axis Label Layout</h4>
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Number of Lines</mat-label>
          <mat-select formControlName="yAxisLabelLines">
            <mat-option [value]="1">
              <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
                <div fxFlex="30" style="font-weight: 500">1 Line</div>
                <div fxFlex style="font-size: 11px; color: #666; font-family: monospace">
                  Temperature (°C) - 1
                </div>
              </div>
            </mat-option>
            <mat-option [value]="2">
              <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
                <div fxFlex="30" style="font-weight: 500">2 Lines</div>
                <div fxFlex style="font-size: 11px; color: #666; font-family: monospace; line-height: 1.4">
                  Temperature<br>(°C) - 1
                </div>
              </div>
            </mat-option>
            <mat-option [value]="3">
              <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
                <div fxFlex="30" style="font-weight: 500">3 Lines</div>
                <div fxFlex style="font-size: 11px; color: #666; font-family: monospace; line-height: 1.4">
                  1<br>Temperature<br>(°C)
                </div>
              </div>
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <h4>Color Scheme</h4>
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Chart Color Scheme</mat-label>
          <mat-select formControlName="colorScheme">
            <mat-option value="default">Default (Blue/Orange/Green)</mat-option>
            <mat-option value="dark">Dark (Deep Colors)</mat-option>
            <mat-option value="vibrant">Vibrant (Bright Colors)</mat-option>
            <mat-option value="pastel">Pastel (Soft Colors)</mat-option>
            <mat-option value="monochrome">Monochrome (Blue Shades)</mat-option>
          </mat-select>
        </mat-form-field>
        
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px;">
          <p style="margin: 8px 0;"><strong>Layout Options:</strong></p>
          <ul style="margin: 4px 0; padding-left: 20px;">
            <li><strong>Stacked:</strong> Traditional 3-line layout with plot number, label, and units on separate lines</li>
            <li><strong>Compact:</strong> Space-saving single line format: "Label (units) · ①"</li>
          </ul>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Legend Style Settings -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Legend Style Settings</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        <mat-checkbox formControlName="showlegend">Show Legend</mat-checkbox>
        
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Legend Color</mat-label>
          <input matInput type="color" formControlName="legendcolortext">
        </mat-form-field>
      </div>
    </mat-expansion-panel>

    <!-- Graph Settings -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Graph Settings</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        <mat-checkbox formControlName="smooth">Smooth out</mat-checkbox>
        
        <!-- Multiple Devices Mode -->
        <mat-checkbox formControlName="multipleDevices">
          Multiple Devices Mode (7 Subplots)
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to support up to 7 subplots for multiple devices. When disabled, uses standard 3 subplot mode.
        </div>
        
        <!-- Left Y-Axis Settings -->
        <div class="axis-section">
          <h4>Left Y-Axis</h4>
          <mat-form-field class="mat-block" appearance="outline">
            <mat-label>Title Left Y-Axis</mat-label>
            <input matInput formControlName="yAxisLeftTitle">
          </mat-form-field>
          
          <mat-form-field class="mat-block" appearance="outline">
            <mat-label>Unit Left Y-Axis</mat-label>
            <input matInput formControlName="yAxisLeftUnit">
          </mat-form-field>
          
          <mat-checkbox formControlName="yAxisLeftAutoScale">Left Y-Axis Autoscale</mat-checkbox>
          
          <div fxLayout="row" fxLayoutGap="16px" *ngIf="!echartsLineChartSettingsForm.get('yAxisLeftAutoScale')?.value">
            <mat-form-field fxFlex appearance="outline">
              <mat-label>Left Y-Axis Min-Value</mat-label>
              <input matInput type="number" formControlName="yAxisLeftMinScale">
            </mat-form-field>
            
            <mat-form-field fxFlex appearance="outline">
              <mat-label>Left Y-Axis Max-Value</mat-label>
              <input matInput type="number" formControlName="yAxisLeftMaxScale">
            </mat-form-field>
          </div>
        </div>

        <!-- Right Y-Axis Settings -->
        <div class="axis-section">
          <h4>Right Y-Axis</h4>
          <mat-form-field class="mat-block" appearance="outline">
            <mat-label>Title Right Y-Axis</mat-label>
            <input matInput formControlName="yAxisRightTitle">
          </mat-form-field>
          
          <mat-form-field class="mat-block" appearance="outline">
            <mat-label>Unit Right Y-Axis</mat-label>
            <input matInput formControlName="yAxisRightUnit">
          </mat-form-field>
          
          <mat-checkbox formControlName="yAxisRightAutoScale">Right Y-Axis Autoscale</mat-checkbox>
          
          <div fxLayout="row" fxLayoutGap="16px" *ngIf="!echartsLineChartSettingsForm.get('yAxisRightAutoScale')?.value">
            <mat-form-field fxFlex appearance="outline">
              <mat-label>Right Y-Axis Min-Value</mat-label>
              <input matInput type="number" formControlName="yAxisRightMinScale">
            </mat-form-field>
            
            <mat-form-field fxFlex appearance="outline">
              <mat-label>Right Y-Axis Max-Value</mat-label>
              <input matInput type="number" formControlName="yAxisRightMaxScale">
            </mat-form-field>
          </div>
          
          <mat-form-field class="mat-block" appearance="outline">
            <mat-label>Right y-Axis Color</mat-label>
            <input matInput type="color" formControlName="yAxisRightColorChoser">
          </mat-form-field>
        </div>

        <!-- Data Points Settings -->
        <mat-checkbox formControlName="showDataPoints">Show Data points</mat-checkbox>
        
        <mat-form-field class="mat-block" appearance="outline" *ngIf="echartsLineChartSettingsForm.get('showDataPoints')?.value">
          <mat-label>Size of Data points</mat-label>
          <input matInput type="number" formControlName="symbolSize_data">
        </mat-form-field>
        
        <mat-checkbox formControlName="showPanZoomTool">Show Pan and Zoom tool</mat-checkbox>
        
        <!-- Grid Layout Settings -->
        <h4>Grid Layout</h4>
        
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Start Scrolling After (Number of Plots)</mat-label>
          <mat-select formControlName="scrollingStartsAfter">
            <mat-option [value]="1">1 Plot (Always scroll)</mat-option>
            <mat-option [value]="2">2 Plots</mat-option>
            <mat-option [value]="3">3 Plots (Default)</mat-option>
            <mat-option [value]="4">4 Plots</mat-option>
            <mat-option [value]="5">5 Plots</mat-option>
            <mat-option [value]="6">6 Plots</mat-option>
            <mat-option [value]="7">7 Plots</mat-option>
          </mat-select>
          <mat-hint>Plots will fit without scrolling up to this number</mat-hint>
        </mat-form-field>
        <div fxLayout="row" fxLayoutGap="16px">
          <mat-form-field fxFlex appearance="outline">
            <mat-label>Markline Left or Right</mat-label>
            <input matInput type="number" formControlName="markline_layout_left_or_right">
          </mat-form-field>
          
          <mat-form-field fxFlex appearance="outline">
            <mat-label>Chart to the left</mat-label>
            <input matInput type="number" formControlName="grid_layout_left">
          </mat-form-field>
        </div>
        
        <div fxLayout="row" fxLayoutGap="16px">
          <mat-form-field fxFlex appearance="outline">
            <mat-label>Chart to the right</mat-label>
            <input matInput type="number" formControlName="grid_layout_right">
          </mat-form-field>
          
          <mat-form-field fxFlex appearance="outline">
            <mat-label>Chart to the top</mat-label>
            <input matInput type="number" formControlName="grid_layout_top">
          </mat-form-field>
        </div>
        
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Chart to the bottom</mat-label>
          <input matInput type="number" formControlName="grid_layout_bottom">
        </mat-form-field>

        <!-- Annotations -->
        <h4>Annotations</h4>
        <div formArrayName="annotations">
          <div *ngFor="let annotation of annotationsFormArray.controls; let i = index" [formGroupName]="i" class="annotation-item">
            <mat-card>
              <mat-card-content>
                <div fxLayout="row" fxLayoutGap="16px">
                  <mat-form-field fxFlex appearance="outline">
                    <mat-label>Annotations Type</mat-label>
                    <mat-select formControlName="annotationsType">
                      <mat-option value="Fixed">Fixed</mat-option>
                      <mat-option value="Attribute">Attribute</mat-option>
                    </mat-select>
                  </mat-form-field>
                  
                  <mat-form-field fxFlex appearance="outline" *ngIf="annotation.get('annotationsType')?.value === 'Fixed'">
                    <mat-label>Fixed Number</mat-label>
                    <input matInput type="number" formControlName="fixedNumber">
                  </mat-form-field>
                  
                  <mat-form-field fxFlex appearance="outline" *ngIf="annotation.get('annotationsType')?.value === 'Attribute'">
                    <mat-label>Attribute</mat-label>
                    <input matInput formControlName="attribute">
                  </mat-form-field>
                </div>
                
                <div fxLayout="row" fxLayoutGap="16px">
                  <mat-form-field fxFlex appearance="outline">
                    <mat-label>Description</mat-label>
                    <input matInput formControlName="description">
                  </mat-form-field>
                  
                  <mat-form-field appearance="outline">
                    <mat-label>Color</mat-label>
                    <mat-select formControlName="color">
                      <mat-option value="Red">Red</mat-option>
                      <mat-option value="Green">Green</mat-option>
                      <mat-option value="Blue">Blue</mat-option>
                      <mat-option value="Yellow">Yellow</mat-option>
                    </mat-select>
                  </mat-form-field>
                  
                  <mat-form-field appearance="outline" *ngIf="annotation.get('annotationsType')?.value === 'Attribute'">
                    <mat-label>Attribute Type</mat-label>
                    <mat-select formControlName="attributeType">
                      <mat-option value="Client">Client</mat-option>
                      <mat-option value="Server">Server</mat-option>
                    </mat-select>
                  </mat-form-field>
                  
                  <mat-form-field appearance="outline">
                    <mat-label>Axis Assignment</mat-label>
                    <mat-select formControlName="axisAssignment">
                      <mat-option value="Left">Left</mat-option>
                      <mat-option value="Right">Right</mat-option>
                    </mat-select>
                  </mat-form-field>
                  
                  <button mat-icon-button color="warn" (click)="removeAnnotation(i)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
        
        <button mat-raised-button color="primary" (click)="addAnnotation()">
          <mat-icon>add</mat-icon>
          Add Annotation
        </button>
      </div>
    </mat-expansion-panel>

    <!-- Export Settings -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Export Settings</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Export Decimal Places</mat-label>
          <input matInput type="number" min="0" max="10" formControlName="exportDecimals">
          <mat-hint>Number of decimal places for exported data in CSV, XLS, and XLSX files</mat-hint>
        </mat-form-field>
        
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px;">
          <p style="margin: 8px 0;"><strong>Note:</strong> This setting controls the precision of numeric values in all exported files.</p>
          <ul style="margin: 4px 0; padding-left: 20px;">
            <li>Default: 6 decimal places (matches ThingsBoard standard)</li>
            <li>Trailing zeros are automatically removed</li>
            <li>Applies to CSV, XLS, and XLSX formats</li>
          </ul>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Tooltip Settings -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Tooltip Settings</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        <mat-checkbox formControlName="tooltipOnlyHoveredGrid">
          Show Only Hovered Grid Series
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          When enabled, tooltip will only display series from the grid/subplot that the mouse is hovering over.
        </div>
        
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Maximum Tooltip Items</mat-label>
          <input matInput type="number" min="1" max="50" formControlName="tooltipMaxItems">
          <mat-hint>Maximum number of series to display in tooltip (1-50)</mat-hint>
        </mat-form-field>
        
        <mat-form-field class="mat-block" appearance="outline" *ngIf="echartsLineChartSettingsForm.get('tooltipOnlyHoveredGrid')?.value">
          <mat-label>Show All Tooltip If Total Series Count ≤</mat-label>
          <input matInput type="number" min="0" max="50" formControlName="tooltipShowAllIfSeriesCountLTE">
          <mat-hint>Show all series from all grids if the total visible series count across all grids is ≤ this value (0 = disabled)</mat-hint>
        </mat-form-field>
      </div>
    </mat-expansion-panel>

    <!-- Features Tab - Control UI Element Visibility -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Features</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        <h4>Button Visibility</h4>
        
        <mat-checkbox formControlName="showImageButton">
          Show Image Export Button
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to show the camera button for exporting chart as image
        </div>
        
        <mat-checkbox formControlName="showExportButton">
          Show Data Export Button
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to show the export dropdown (CSV, XLS, XLSX)
        </div>
        
        <mat-checkbox formControlName="showResetZoomButton">
          Show Reset Zoom Button
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to show the reset zoom button
        </div>
        
        <h4>Sidebar Features</h4>
        
        <mat-checkbox formControlName="showEntitySidebar">
          Show Entity Sidebar
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to show the entity list on the left side
        </div>
        
        <h4>Chart Features</h4>
        
        <mat-checkbox formControlName="showCustomLegend">
          Show Custom Legend
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to show the custom legend with plot numbers
        </div>
        
        <mat-checkbox formControlName="showZoomControls">
          Show Zoom Controls
        </mat-checkbox>
        <div class="info-text" style="color: rgba(0,0,0,0.6); font-size: 12px; margin-left: 32px; margin-top: -8px;">
          Enable to show the bottom zoom slider controls
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Debug Settings -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Debug & Performance</mat-panel-title>
      </mat-expansion-panel-header>
      
      <div fxLayout="column" fxLayoutGap="16px">
        <mat-checkbox formControlName="debugOutput">Use Debug Output</mat-checkbox>
        
        <mat-checkbox formControlName="useLazyLoading">
          <div fxLayout="column">
            <span>Use Lazy Loading</span>
            <small style="color: #666; font-size: 11px;">
              Enable deferred chart rendering for better initial load performance with large datasets
            </small>
          </div>
        </mat-checkbox>
        
        <mat-checkbox formControlName="enableAnimations">
          <div fxLayout="column">
            <span>Enable Chart Animations</span>
            <small style="color: #666; font-size: 11px;">
              Enable smooth transitions and animations (disable for better performance with large datasets)
            </small>
          </div>
        </mat-checkbox>
        
        <mat-checkbox formControlName="useCanvasRenderer">
          <div fxLayout="column">
            <span>Use Canvas Renderer</span>
            <small style="color: #666; font-size: 11px;">
              Use Canvas instead of SVG for rendering (better performance for large datasets, lower quality)
            </small>
          </div>
        </mat-checkbox>
        
        <mat-checkbox formControlName="enableDataSampling">
          <div fxLayout="column">
            <span>Enable Data Sampling</span>
            <small style="color: #666; font-size: 11px;">
              Automatically reduce data points for better performance when dataset exceeds threshold
            </small>
          </div>
        </mat-checkbox>
        
        <mat-form-field class="mat-block" appearance="outline">
          <mat-label>Max Data Points</mat-label>
          <input matInput type="number" formControlName="maxDataPoints" min="1000" max="100000" step="1000">
          <mat-hint>Maximum data points per series before sampling kicks in</mat-hint>
        </mat-form-field>
        
        <mat-checkbox formControlName="enableProgressiveRendering">
          <div fxLayout="column">
            <span>Enable Progressive Rendering</span>
            <small style="color: #666; font-size: 11px;">
              Render chart progressively for very large datasets (experimental, may cause visual glitches)
            </small>
          </div>
        </mat-checkbox>
      </div>
    </mat-expansion-panel>

  </div>
</form>